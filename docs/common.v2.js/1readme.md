# Вводная

Раздел посвящен библиотеке `common.v2.js`, которая является набором готовых скриптов для упрощения и ускорения разработки шаблонов на платформе InSales.

## Модули

**[Товар:](/common.v2.js/2Products/)**

- Назначение атрибутов
- Селектор модификаций
- Методы класса Products
- События

**[Корзина:](/common.v2.js/3Cart/)**

- Назначение атрибутов
- Методы и события

**[Живой поиск по сайту:](/common.v2.js/AjaxSearch/)**

- Назначение атрибутов
- Методы класса AjaxSearch
- События

**[Сравнение:](/common.v2.js/Compare/)**

- Назначение атрибутов
- Методы и события

**[Избранное:](/common.v2.js/FavoritesProducts/)**

- Назначение атрибутов
- Методы класса FavoritesProducts
- События

**[Шина событий EventBus:](/common.v2.js/EventBus/)**

- Подписка на события
- Создание событий
- Отладка событий

**[Lodash шаблоны:](/common.v2.js/Template/)**

- Работа с динамическими данными через шаблонизатор библиотеки Lodash

**[Модуль для работы с API магазина:](/common.v2.js/ajaxAPI/)**

- Инструмент для получения и обновления данных о товарах, содержимого корзины, клиентах, категориях
- Отправка сообщений в формах обратной связи, отзывов, комментариев к статьям
- Отправка формы заказа

**[Примеры кода](https://github.com/liquid-hub/insales-common-js-v2-api){:target="_blank"}**
## Подключение

В шаблоны `layots.{layout,checkout2,client_account}.liquid` добавить тег `include_insales_scripts` с параметром `common-js@v2`

```
{% include_insales_scripts "common-js@v2" %}
```

Так же можно подключить через settings_data.json, прописав там поле - "common_js_version": "v2".

Файл settings_data.json не доступен через бэк-офис, поэтому новое свойство нужно добавлять вручную через скачивание шаблона и последующей установке с новыми параметрами. Так же файл можно поправить если для разработки вы используете — [InSales-uploader](https://insales.github.io/insales-uploader/){:target="_blank"}.

Пример `settings_data.json`:
```json
{
  "common_js_version": "v2",
  "presets": {
    "custom": {
      "color_text_primary": "#222222",
      "font_size_primary": "16px"
    }
  },
  "theme_title": "Базовый шаблон"
}
```

!!! info
    В шаблонах 4 поколения, common-js указывается в качестве зависимости для виджетов

## ВАЖНО ЗНАТЬ

#### Библиотеки используемые в Common.js:

- [Lodash](https://lodash.com/docs/){:target="_blank"}
- [jQuery](http://jquery.com/){:target="_blank"}

Lodash доступен глобально, можно и нужно пользоваться возможностями этой библиотеки при разработке.

#### Имена переменных которые Common.js присваивает в глобальную область видимости:

- Cart
- Shop
- Products
- Compare
- Site
- AjaxSearch
- ajaxAPI
- Template
- EventBus

В проектах где используется Common.js нельзя переопределять данные переменные, так же при подключении Common.js к работающему сайту нужно проверять переменные на переопределение и особенно обратить внимание на переменные `Cart` и `Site`.

#### Готовые решения Common.js для компонентов магазина работают по следующей логике:

1. В разметку компонента проставляются обязательные data-атрибуты. В эти атрибуты из liquid передаются данные из магазина, а так же есть data-атрибуты, которые реализуют действия (кнопки добавить или удалить товар из корзины, переключение модификаций, изменение количества и т.д.).
2. Common.js при загрузке страницы пробегает по проставленным data-атрибутам и на основе данных инициализирует скрипты для работы компонентов. 
3. Практически на каждое взаимодействие с компонентами реализованными с помощью фреймворка (обновление корзины, переключение модификации и т.д.) можно повесить обработчик, в callback которого приходит информация о событии, например при обновлении корзины в callback попадает информация о актуальном состоянии корзины, исходя из чего можно сделать динамический виджет корзины или обновление информации на странице корзины без перезагрузки страницы.

Так же стоит ознакомиться с [подробным описанием API фреймворка Common.js](/common.v2.js/ajaxAPI/).

API фреймворка предоставляет удобные и протестированые методы, для разработки своих компонентов.

Все обращения к API нужно производить после события `DOMContentLoaded` оно же `$(document).ready(function() {}), $(function() {})`.
